<div id="client-subscriptions" class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h6 class="mb-0">订阅管理 - {{ client.name }}</h6>
    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addSubscriptionModal">
      添加议题订阅
    </button>
  </div>
  <div class="card-body">
    {% if subscriptions %}
      <div class="table-responsive">
        <table class="table table-sm">
          <thead>
            <tr>
              <th>订阅议题</th>
              <th>状态</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            {% for topic in subscriptions %}
            <tr>
            <td>{{ topic.name }}</td>
            <td>
              <span class="badge bg-success">激活</span>
            </td>
            <td>
              <button class="btn btn-sm btn-outline-danger"
                      hx-delete="/api/clients/{{ client.id }}/topics/{{ topic.id }}"
                      hx-confirm="确定取消订阅“{{ topic.name }}”这个议题吗？"
                      hx-target="closest tr"
                      hx-swap="outerHTML">
                取消订阅
              </button>
            </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center text-muted py-4">
        <p>该客户端暂无议题订阅</p>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSubscriptionModal">
          添加第一个订阅
        </button>
      </div>
    {% endif %}
  </div>
</div>

<div class="modal fade" id="addSubscriptionModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h6 class="modal-title">为 {{ client.name }} 添加议题订阅</h6>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form hx-post="/api/clients/{{ client.id }}/subscriptions"
              hx-target="#client-subscriptions"
              hx-swap="outerHTML"
              hx-on::after-request="if(event.detail.successful) bootstrap.Modal.getInstance(document.getElementById('addSubscriptionModal')).hide()">

          <div class="mb-3">
            <label class="form-label">选择议题</label>
            <select name="topic_id" class="form-select" required>
              <option value="">请选择...</option>
              {% for topic in available_topics %}
              <option value="{{ topic.id }}">{{ topic.name }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" name="is_active" id="isActive" checked>
            <label class="form-check-label" for="isActive">
              立即激活
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
        <button type="button" class="btn btn-primary" onclick="document.querySelector('#addSubscriptionModal form').requestSubmit()">
          添加订阅
        </button>
      </div>
    </div>
  </div>
</div>